const e=new class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.board=e,this.score=0}filterZero(e){return e.filter(e=>0!==e)}renderBoard(){let e=document.querySelectorAll(".game-field td");for(let t=0;t<4;t++)for(let r=0;r<4;r++){let s=e[4*t+r],o=this.board[t][r];s.classList="field-cell",0===o?s.textContent="":(s.textContent=o,s.classList.add(`field-cell--${o}`))}document.querySelector(".game-score").textContent=`${this.score}`}spawnNumber(){let e=[];for(let t=0;t<4;t++)for(let r=0;r<4;r++)0===this.board[t][r]&&e.push({row:t,col:r});if(0===e.length)return;let t=e[Math.floor(Math.random()*e.length)],r=.1>Math.random()?4:2;this.board[t.row][t.col]=r,this.renderBoard()}isGameOver(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(2048===this.board[e][t])return"win";for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(0===this.board[e][t]||t<3&&this.board[e][t]===this.board[e][t+1]||e<3&&this.board[e][t]===this.board[e+1][t])return"playing";return"lose"}moveLeft(){for(let e=0;e<4;e++){let t=this.board[e];t=this.filterZero(t);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,t[e+1]=0,this.score+=t[e]);for(t=this.filterZero(t);t.length<4;)t.push(0);this.board[e]=t}this.renderBoard(),this.spawnNumber(),this.checkGameStatus()}moveRight(){for(let e=0;e<4;e++){let t=this.board[e].reverse();t=this.filterZero(t);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,t[e+1]=0,this.score+=t[e]);for(t=this.filterZero(t);t.length<4;)t.push(0);this.board[e]=t.reverse()}this.renderBoard(),this.spawnNumber(),this.checkGameStatus()}moveUp(){for(let e=0;e<4;e++){let t=[];for(let r=0;r<4;r++)t.push(this.board[r][e]);t=this.filterZero(t);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,t[e+1]=0,this.score+=t[e]);for(t=this.filterZero(t);t.length<4;)t.push(0);for(let r=0;r<4;r++)this.board[r][e]=t[r]}this.renderBoard(),this.spawnNumber(),this.checkGameStatus()}moveDown(){for(let e=0;e<4;e++){let t=[];for(let r=0;r<4;r++)t.push(this.board[r][e]);(t=this.filterZero(t)).reverse();for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,t[e+1]=0,this.score+=t[e]);for(t=this.filterZero(t);t.length<4;)t.push(0);t.reverse();for(let r=0;r<4;r++)this.board[r][e]=t[r]}this.renderBoard();let e=JSON.stringify(this.getState());this.currentBoard!==e&&this.spawnNumber(),this.checkGameStatus()}getScore(){return this.score}getState(){return this.board}getStatus(){let e=document.querySelector(".message-container").querySelector("p:not(.hidden)");if(!e)return"playing";switch(e.classList){case"message message-start":return"idle";case"message message-win":return"win";case"message message-lose":return"lose"}}checkGameStatus(){let e=this.isGameOver();("win"===e||"lose"===e)&&this.showMessage(e)}showMessage(e){document.querySelector(`.message.message-${e}`).classList.remove("hidden"),document.removeEventListener("keydown",this.boundKeyDown)}start(){let e=document.querySelectorAll(".game-field td");Array.from({length:e.length},(e,t)=>t).sort(()=>.5-Math.random()).slice(0,2).forEach(t=>{e[t].textContent="2",e[t].classList.add("field-cell--2");let r=Math.floor(t/4);this.board[r][t%4]=2}),document.querySelector(".message.message-start").classList.add("hidden"),this.boundKeyDown=this.keyDown.bind(this),document.addEventListener("keydown",this.boundKeyDown)}restart(){document.querySelectorAll(".game-field td").forEach(e=>{e.classList="field-cell",e.textContent=""});for(let e=0;e<4;e++)for(let t=0;t<4;t++)this.board[e][t]=0;document.querySelector(".message.message-start").classList.remove("hidden"),document.removeEventListener("keydown",this.boundKeyDown)}keyDown(e){switch(e.preventDefault(),e.key){case"ArrowUp":this.moveUp();break;case"ArrowDown":this.moveDown();break;case"ArrowLeft":this.moveLeft();break;case"ArrowRight":this.moveRight()}this.checkGameStatus()}},t=document.querySelector("button.start");let r=0;t.addEventListener("click",s=>{++r%2==1?(t.classList.remove("start"),t.classList.add("restart"),t.textContent="Restart",e.start()):(t.classList.remove("restart"),t.classList.add("start"),t.textContent="Start",e.restart())});
//# sourceMappingURL=index.673ee22b.js.map
